<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulador PAES Kent</title>
    <link rel="icon" type="image/png" href="./favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/svg+xml" href="./favicon.svg" />
    <link rel="shortcut icon" href="./favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="./apple-touch-icon.png" />
    <meta name="apple-mobile-web-app-title" content="PAES Kent" />
    <link rel="manifest" href="./site.webmanifest" />
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;700;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Poppins', sans-serif; background-color: #fafcff; }
        ::placeholder { color: #A0AEC0; }
        #career-list { position: absolute; background-color: white; border: 1px solid #E2E8F0; border-radius: 0.5rem; width: 100%; max-height: 150px; overflow-y: auto; z-index: 10; margin-top: 0.25rem; }
        #career-list div { padding: 0.75rem; cursor: pointer; }
        #career-list div:hover { background-color: #F1F5F9; }
        .hidden { display: none; }
        .accent-text { color: #015ad6; }
        .accent-bg { background-color: #015ad6; }
        .accent-ring:focus { ring-color: #015ad6; }
        .nem-bg { background-color: #f59e0b; } /* Amber 500 */
        .rkg-bg { background-color: #84cc16; } /* Lime 500 */
        .clec-bg { background-color: #eb2d32; }
        .m1-bg { background-color: #015ad6; }
        .cie-bg { background-color: #009f58; }
        .hcs-bg { background-color: #5e17eb; }
        .m2-bg { background-color: #1287d1; }
        .clec-bg-light { background-color: rgba(235, 45, 50, 0.1); }
        .clec-text-dark { color: #9b1c20; }
        .m1-bg-light { background-color: rgba(1, 90, 214, 0.1); }
        .m1-text-dark { color: #01449d; }
        .cie-bg-light { background-color: rgba(0, 159, 88, 0.1); }
        .cie-text-dark { color: #00693b; }
        .hcs-bg-light { background-color: rgba(94, 23, 235, 0.1); }
        .hcs-text-dark { color: #4311a9; }
        .m2-bg-light { background-color: rgba(18, 135, 209, 0.1); }
        .m2-text-dark { color: #0c639c; }
        .text-impossible { color: #eb2d32; }
    </style>
</head>
<body class="text-gray-800">

    <div class="container mx-auto max-w-lg p-6 space-y-8">

        <header class="text-center">
            <h1 class="text-4xl font-extrabold accent-text">Simulador PAES Kent</h1>
        </header>

        <main class="space-y-10">
            <!-- Sección 1: Promedios NEM -->
            <section id="nem-section">
                <h2 class="text-xl font-bold mb-4">1. Ingresa tus promedios <span class="font-normal text-gray-500">(reales o imaginarios, puedes dejar algunos en blanco)</span></h2>
                <div class="grid grid-cols-2 gap-4 mb-4">
                    <input type="text" id="nem1" placeholder="I° Medio" class="w-full p-3 text-center bg-white border border-gray-200 rounded-full shadow-sm focus:ring-2 focus:outline-none accent-ring">
                    <input type="text" id="nem2" placeholder="II° Medio" class="w-full p-3 text-center bg-white border border-gray-200 rounded-full shadow-sm focus:ring-2 focus:outline-none accent-ring">
                    <input type="text" id="nem3" placeholder="III° Medio" class="w-full p-3 text-center bg-white border border-gray-200 rounded-full shadow-sm focus:ring-2 focus:outline-none accent-ring">
                    <input type="text" id="nem4" placeholder="IV° Medio" class="w-full p-3 text-center bg-white border border-gray-200 rounded-full shadow-sm focus:ring-2 focus:outline-none accent-ring">
                </div>
                <div id="nem-error" class="text-red-500 text-sm text-center mb-4 hidden"><span class="font-bold">▲</span> Entrada inválida</div>
                <div class="text-center text-gray-600">
                    <p>Según lo ingresado, tu NEM sería de <strong id="nem-result" class="accent-text">...</strong> puntos*</p>
                    <p>Y tu Ranking sería de <strong id="ranking-result" class="accent-text">...</strong> puntos*</p>
                    <p class="text-xs text-gray-400 mt-2">*Datos para la generación que egresa el 2025.</p>
                </div>
            </section>

            <!-- Sección 2: Selección de Carrera y Ponderaciones -->
            <section id="career-section">
                <h2 class="text-xl font-bold mb-4">2. Elige una carrera</h2>
                <div class="relative">
                    <input type="text" id="career-input" placeholder="Cargando carreras..." class="w-full p-3 text-center bg-white border border-gray-200 rounded-full shadow-sm focus:ring-2 focus:outline-none accent-ring" disabled>
                    <div id="career-list" class="hidden"></div>
                </div>
                <div id="special-test-warning" class="hidden mt-2 text-center text-sm text-yellow-700 bg-yellow-100 p-2 rounded-lg">⚠️ ¡Atención! Esta carrera requiere una prueba especial.</div>
                
                <h3 class="text-lg font-bold mt-6 mb-2 text-center">Ponderaciones</h3>
                <div class="flex flex-wrap justify-center gap-2 text-white text-xs text-center">
                    <div class="p-2 nem-bg rounded-lg shadow flex-1 min-w-[60px]"><strong class="font-bold">NEM</strong><br><span id="pond-nem" class="text-lg font-bold">...</span></div>
                    <div class="p-2 rkg-bg rounded-lg shadow flex-1 min-w-[60px]"><strong class="font-bold">RKG</strong><br><span id="pond-rkg" class="text-lg font-bold">...</span></div>
                    <div class="p-2 clec-bg rounded-lg shadow flex-1 min-w-[60px]"><strong class="font-bold">C.LEC</strong><br><span id="pond-clec" class="text-lg font-bold">...</span></div>
                    <div class="p-2 m1-bg rounded-lg shadow flex-1 min-w-[60px]"><strong class="font-bold">M1</strong><br><span id="pond-m1" class="text-lg font-bold">...</span></div>
                    <div class="p-2 cie-bg rounded-lg shadow flex-1 min-w-[60px]"><strong class="font-bold">CIE</strong><br><span id="pond-cie" class="text-lg font-bold">...</span></div>
                    <div class="p-2 hcs-bg rounded-lg shadow flex-1 min-w-[60px]"><strong class="font-bold">HCS</strong><br><span id="pond-hcs" class="text-lg font-bold">...</span></div>
                    <div class="p-2 m2-bg rounded-lg shadow flex-1 min-w-[60px]"><strong class="font-bold">M2</strong><br><span id="pond-m2" class="text-lg font-bold">...</span></div>
                </div>
            </section>

            <!-- Sección 3: Puntajes PAES -->
            <section id="paes-section">
                <h2 class="text-xl font-bold mb-4">3. Ingresa puntajes PAES <span class="font-normal text-gray-500">(reales o imaginarios)</span></h2>
                <div class="grid grid-cols-2 gap-4">
                    <div class="clec-bg-light p-4 rounded-2xl text-center"><label for="paes-clec" class="font-bold clec-text-dark">C. LECTORA</label><input type="number" id="paes-clec" class="w-full mt-2 p-2 text-center text-2xl font-bold bg-transparent focus:outline-none" placeholder="..."></div>
                    <div class="m1-bg-light p-4 rounded-2xl text-center"><label for="paes-m1" class="font-bold m1-text-dark">MATEMÁTICA 1</label><input type="number" id="paes-m1" class="w-full mt-2 p-2 text-center text-2xl font-bold bg-transparent focus:outline-none" placeholder="..."></div>
                    <div class="cie-bg-light p-4 rounded-2xl text-center"><label for="paes-cie" class="font-bold cie-text-dark">CIENCIAS</label><input type="number" id="paes-cie" class="w-full mt-2 p-2 text-center text-2xl font-bold bg-transparent focus:outline-none" placeholder="..."></div>
                    <div class="hcs-bg-light p-4 rounded-2xl text-center"><label for="paes-hcs" class="font-bold hcs-text-dark">HISTORIA Y CS. SOC.</label><input type="number" id="paes-hcs" class="w-full mt-2 p-2 text-center text-2xl font-bold bg-transparent focus:outline-none" placeholder="..."></div>
                    <div class="m2-bg-light p-4 rounded-2xl text-center col-span-2"><label for="paes-m2" class="font-bold m2-text-dark">MATEMÁTICA 2</label><input type="number" id="paes-m2" class="w-full mt-2 p-2 text-center text-2xl font-bold bg-transparent focus:outline-none" placeholder="..."></div>
                </div>
            </section>

            <!-- Sección 4: Resultados -->
            <section id="results-section" class="text-center bg-white p-6 rounded-2xl shadow-md">
                <h2 class="text-2xl font-bold mb-4">Resultados de la Simulación</h2>
                <div class="space-y-4 text-gray-700">
                    <p>El último puntaje de corte para esta carrera fue de <strong id="corte-result" class="accent-text text-lg">...</strong> puntos.</p>
                    <p>Solo con lo que has ingresado, ponderarías <strong id="ponderado-result" class="accent-text text-lg">...</strong> puntos.</p>
                    <p>Considerando solo tu NEM y Ranking, tendrías que sacar en promedio <strong id="promedio-paes-nem-result" class="accent-text text-lg">...</strong> puntos para superar el corte.</p>
                    <p>Considerando los puntajes que ingresaste, tendrías que sacar en promedio <strong id="promedio-paes-resto-result" class="accent-text text-lg">...</strong> puntos en el resto de pruebas para superar el corte.</p>
                </div>
            </section>
        </main>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded",(()=>{let e=[],t=null,n={};const c={promMaxHist:6.96,promHist:6.45,promHistNEM:0,pendienteRkg:0};document.querySelectorAll("input").forEach((e=>{e.value=""}));const o=["nem1","nem2","nem3","nem4"].map((e=>document.getElementById(e))),r=document.getElementById("nem-error"),s=document.getElementById("nem-result"),a=document.getElementById("ranking-result"),i=document.getElementById("career-input"),d=document.getElementById("career-list"),m=document.getElementById("special-test-warning"),l={clec:document.getElementById("paes-clec"),m1:document.getElementById("paes-m1"),m2:document.getElementById("paes-m2"),cie:document.getElementById("paes-cie"),hcs:document.getElementById("paes-hcs")},u={nem:document.getElementById("pond-nem"),rkg:document.getElementById("pond-rkg"),clec:document.getElementById("pond-clec"),m1:document.getElementById("pond-m1"),m2:document.getElementById("pond-m2"),cie:document.getElementById("pond-cie"),hcs:document.getElementById("pond-hcs")},p={cut:document.getElementById("corte-result"),ponderado:document.getElementById("ponderado-result"),promedioNem:document.getElementById("promedio-paes-nem-result"),promedioResto:document.getElementById("promedio-paes-resto-result")};function g(){let e=!1;const n=[],i=/^\s*(\d+([,.]\d*)?|\.\d+)\s*$/;for(const t of o){const c=t.value;if(""===c)continue;if(!i.test(c)){e=!0;break}let o=parseFloat(c.replace(",",".").replace(" ",""));if(isNaN(o)||o<4||o>7){e=!0;break}o=Math.trunc(100*o)/100,n.push(o)}if(r.classList.toggle("hidden",!e),e)s.textContent="...",a.textContent="...";else if(n.length>0){let e=n.reduce(((e,t)=>e+t),0),t=parseFloat((e/n.length).toFixed(2));s.textContent=h(t),a.textContent=function(e){if(!e||0===c.pendienteRkg)return 0;if(e>=c.promMaxHist)return 1e3;if(e<c.promHist)return h(e);const t=1e3-c.pendienteRkg*(c.promMaxHist-e);return Math.round(t)}(t)}else s.textContent="...",a.textContent="...";if(!t)return p.cut.textContent="...",p.ponderado.textContent="...",p.promedioNem.textContent="...",p.promedioResto.textContent="...",Object.values(u).forEach((e=>e.textContent="...")),void m.classList.add("hidden");0==t.cut?p.cut.textContent="Sin información - Carrera nueva":p.cut.textContent=t.cut;const d={nem:parseFloat(s.textContent)||0,rkg:parseFloat(a.textContent)||0,clec:parseFloat(l.clec.value)||0,m1:parseFloat(l.m1.value)||0,m2:parseFloat(l.m2.value)||0,cie:parseFloat(l.cie.value)||0,hcs:parseFloat(l.hcs.value)||0},g=E(d,t.weights);p.ponderado.textContent=g.toFixed(2).replace(".",","),f(p.promedioNem,function(e,t,n,c){const o=t*c.nem/100,r=n*c.rkg/100,s=e-o-r,a=100-c.nem-c.rkg;if(a<=0)return"N/A";const i=100*s/a;return i>1e3?"+1000":i.toFixed(2).replace(".",",")}(t.cut,d.nem,d.rkg,t.weights)),f(p.promedioResto,function(e,t,n){const c=E(t,n),o=e-c;let r=0;!t.clec&&n.clec>0&&(r+=n.clec);!t.m1&&n.m1>0&&(r+=n.m1);!t.m2&&n.m2>0&&(r+=n.m2);n.cie==n.hcs?t.cie||t.hcs||(r+=n.cie):(!t.cie&&n.cie>0&&(r+=n.cie),!t.hcs&&n.hcs>0&&(r+=n.hcs));if(o<=0)return"¡Ya superaste el corte!";if(0===r)return"N/A";const s=100*o/r;return s>1e3?"+1000":s.toFixed(2).replace(".",",")}(t.cut,d,t.weights))}function h(e){if(!e||!Object.keys(n).length)return 0;const t=e.toFixed(2);return n[t]||0}function E(e,t){let n=0;return t.nem&&(n+=e.nem*t.nem/100),t.rkg&&(n+=e.rkg*t.rkg/100),t.clec&&(n+=e.clec*t.clec/100),t.m1&&(n+=e.m1*t.m1/100),t.m2&&(n+=e.m2*t.m2/100),t.cie==t.hcs?e.cie>e.hcs?t.cie&&(n+=e.cie*t.cie/100):t.hcs&&(n+=e.hcs*t.hcs/100):(t.cie&&(n+=e.cie*t.cie/100),t.hcs&&(n+=e.hcs*t.hcs/100)),n}function f(e,t){e.textContent=t,"+1000"===t?e.classList.add("text-impossible"):e.classList.remove("text-impossible")}[...o,...Object.values(l)].forEach((e=>e.addEventListener("input",g))),i.addEventListener("input",(()=>{const n=i.value.toLowerCase();if(""===n&&(t=null,g()),n.length<2)return void d.classList.add("hidden");const c=e.filter((e=>e.name.toLowerCase().includes(n)));d.innerHTML="",c.slice(0,50).forEach((e=>{const n=document.createElement("div");n.textContent=e.name,n.addEventListener("click",(()=>{i.value=e.name,d.classList.add("hidden"),t=e,m.classList.toggle("hidden",!e.specialTest||"0"===e.specialTest),function(e){for(const t in u)u[t].textContent=(e[t]||0)+"%"}(e.weights),g()})),d.appendChild(n)})),d.classList.remove("hidden")})),i.addEventListener("blur",(()=>{setTimeout((()=>{i.value=t?t.name:"",d.classList.add("hidden")}),200)})),async function(){try{const[t,o]=await Promise.all([fetch("./carreras.json"),fetch("./nem.json")]);if(!t.ok)throw new Error("Error al cargar carreras: ${careersResponse.statusText}");if(!o.ok)throw new Error("Error al cargar tabla NEM: ${nemResponse.statusText}");const r=await t.json();e=r.map((e=>({id:e.COD,name:e.NOMBRE,cut:parseFloat(e.PUM)||0,specialTest:e.PE,weights:{nem:parseInt(e.NEM,10)||0,rkg:parseInt(e.RKG,10)||0,clec:parseInt(e.CLEC,10)||0,m1:parseInt(e.CMAT1,10)||0,hcs:parseInt(e.HCS,10)||0,cie:parseInt(e.CIE,10)||0,m2:parseInt(e.CMAT2,10)||0}}))),n=await o.json(),c.promHistNEM=h(c.promHist),c.pendienteRkg=(1e3-c.promHistNEM)/(c.promMaxHist-c.promHist),i.disabled=!1,i.placeholder="Escribe aquí una carrera"}catch(e){console.error("Error durante la inicialización:",e),i.placeholder="Error al cargar datos"}}()}));
    </script>
</body>
</html>
